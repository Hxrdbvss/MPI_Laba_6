–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ6: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞ —Å–æ–ø—Ä—è–∂—ë–Ω–Ω—ã—Ö –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤ —Å –¥–µ–∫–∞—Ä—Ç–æ–≤–æ–π —Ç–æ–ø–æ–ª–æ–≥–∏–µ–π üöÄ
–ê–≤—Ç–æ—Ä: –í–∞—à–µ –∏–º—è–î–∞—Ç–∞: –û–∫—Ç—è–±—Ä—å 2025
–¶–µ–ª—å —Ä–∞–±–æ—Ç—ã üéØ
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –º–µ—Ç–æ–¥–∞ —Å–æ–ø—Ä—è–∂—ë–Ω–Ω—ã—Ö –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤ (CG) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥–µ–∫–∞—Ä—Ç–æ–≤–æ–π —Ç–æ–ø–æ–ª–æ–≥–∏–∏ –≤ MPI. –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ —Å –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç–æ–π ‚Ññ3 (–±–∞–∑–æ–≤—ã–π CG, –ø–æ–ª–Ω–∞—è –∏ —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏–∏).
–°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π üõ†Ô∏è

–Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è: Python
–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏: mpi4py, numpy, matplotlib
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è MPI: OpenMPI

–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å üìö
–ú–µ—Ç–æ–¥ —Å–æ–ø—Ä—è–∂—ë–Ω–Ω—ã—Ö –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤ (CG) —Ä–µ—à–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É ( Ax = b ), —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –¥–ª—è —Ä–∞–∑—Ä–µ–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º. –í –¥–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 2D –¥–µ–∫–∞—Ä—Ç–æ–≤–∞ —Ç–æ–ø–æ–ª–æ–≥–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π:

–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö: –ú–∞—Ç—Ä–∏—Ü–∞ ( A ) –¥–µ–ª–∏—Ç—Å—è –ø–æ —Å—Ç—Ä–æ–∫–∞–º, –≤–µ–∫—Ç–æ—Ä—ã ( x, r, p ) —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏.
–¢–æ–ø–æ–ª–æ–≥–∏—è: –¢–æ—Ä–æ–∏–¥–∞–ª—å–Ω–∞—è 2D-—Å–µ—Ç–∫–∞ —É–ø—Ä–æ—â–∞–µ—Ç –æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏.
–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏: Sendrecv_replace –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –æ–±–º–µ–Ω–æ–≤, Allreduce –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.
–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –õ–†3: –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ç–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

–ß–∞—Å—Ç—å 1: –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ–∫–∞—Ä—Ç–æ–≤–æ–π —Ç–æ–ø–æ–ª–æ–≥–∏–∏ üåê
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã

–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MPI, –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ—Å—Ç–∏ —á–∏—Å–ª–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (( size = root^2 )).
–°–æ–∑–¥–∞–Ω–∏–µ 2D —Ç–æ—Ä–æ–∏–¥–∞–ª—å–Ω–æ–π —Ç–æ–ø–æ–ª–æ–≥–∏–∏ (comm.Create_cart).
–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Å–µ–¥–µ–π (Shift –¥–ª—è –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ –∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏).
–ö–æ–ª—å—Ü–µ–≤–æ–π –æ–±–º–µ–Ω: –ø–µ—Ä–µ–¥–∞—á–∞ —Ä–∞–Ω–≥–æ–≤ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ (Sendrecv_replace), —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Å—Ç—Ä–æ–∫–µ (row_comm.allreduce).
–í—ã–≤–æ–¥ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç, —Å–æ—Å–µ–¥–µ–π –∏ —Å—É–º–º.

–ö–æ–¥
cartesian_topology.py
from mpi4py import MPI
import numpy as np
import math

comm = MPI.COMM_WORLD
rank = comm.Get_rank()
size = comm.Get_size()

root = int(math.sqrt(size))
if root * root != size:
    if rank == 0:
        print("–û—à–∏–±–∫–∞: –ß–∏—Å–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫–≤–∞–¥—Ä–∞—Ç–æ–º –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–æ–≥–æ —á–∏—Å–ª–∞!")
    MPI.Finalize()
    exit()

dims = (root, root)
periods = (True, True)
comm_cart = comm.Create_cart(dims=dims, periods=periods, reorder=True)

new_rank = comm_cart.Get_rank()
coords = comm_cart.Get_coords(new_rank)

print(f"–ü—Ä–æ—Ü–µ—Å—Å {rank} -> –ù–æ–≤—ã–π —Ä–∞–Ω–≥ {new_rank}, –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã {coords}")

neighbour_up, neighbour_down = comm_cart.Shift(direction=0, disp=1)
neighbour_left, neighbour_right = comm_cart.Shift(direction=1, disp=1)

print(f"–ü—Ä–æ—Ü–µ—Å—Å {new_rank} (coords {coords}): –í–µ—Ä—Ö–Ω–∏–π —Å–æ—Å–µ–¥ = {neighbour_up}, "
      f"–ù–∏–∂–Ω–∏–π —Å–æ—Å–µ–¥ = {neighbour_down}, –õ–µ–≤—ã–π —Å–æ—Å–µ–¥ = {neighbour_left}, "
      f"–ü—Ä–∞–≤—ã–π —Å–æ—Å–µ–¥ = {neighbour_right}")

a = np.array([new_rank], dtype=np.float64)
total_sum = a.copy()

row_comm = comm_cart.Sub((False, True))

for _ in range(dims[1] - 1):
    send_buf = a.copy()
    comm_cart.Sendrecv_replace(send_buf, dest=neighbour_right, source=neighbour_left)
    total_sum += send_buf

row_sum = np.array([new_rank], dtype=np.float64)
row_sum = row_comm.allreduce(row_sum, op=MPI.SUM)

print(f"–ü—Ä–æ—Ü–µ—Å—Å {new_rank} (coords {coords}): –°—É–º–º–∞ –ø–æ—Å–ª–µ –∫–æ–ª—å—Ü–∞ = {row_sum[0]}")

–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏: –ó–∞–≤—ã—à–µ–Ω–Ω—ã–µ —Å—É–º–º—ã (2.0, 10.0; 9.0, 36.0, 63.0; 24.0, 88.0, 152.0, 216.0) —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ–±–º–µ–Ω–∞ –∏ —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.
–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
4 –ø—Ä–æ—Ü–µ—Å—Å–∞ (2x2): —Å—Ç—Ä–æ–∫–∞ 0 (0+1) = 1.0; —Å—Ç—Ä–æ–∫–∞ 1 (2+3) = 5.0.
9 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (3x3): —Å—Ç—Ä–æ–∫–∞ 0 (0+1+2) = 3.0; —Å—Ç—Ä–æ–∫–∞ 1 (3+4+5) = 12.0; —Å—Ç—Ä–æ–∫–∞ 2 (6+7+8) = 21.0.
16 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (4x4): —Å—Ç—Ä–æ–∫–∞ 0 (0+1+2+3) = 6.0; —Å—Ç—Ä–æ–∫–∞ 1 (4+5+6+7) = 22.0; —Å—Ç—Ä–æ–∫–∞ 2 (8+9+10+11) = 38.0; —Å—Ç—Ä–æ–∫–∞ 3 (12+13+14+15) = 54.0.



–ß–∞—Å—Ç—å 2: –ú–µ—Ç–æ–¥ CG —Å —Ç–æ–ø–æ–ª–æ–≥–∏–µ–π üîÑ
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã

–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MPI –∏ —Ç–æ–ø–æ–ª–æ–≥–∏–∏ (( root \times root )).
–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –º–∞—Ç—Ä–∏—Ü—ã ( A ) (( n \times n )) –ø–æ —Å—Ç—Ä–æ–∫–∞–º (( n_{\text{local}} = n / root
