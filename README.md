# –û–¢–ß–ï–¢
## –ü–æ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç–µ ‚Ññ6: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞ —Å–æ–ø—Ä—è–∂—ë–Ω–Ω—ã—Ö –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤ —Å –¥–µ–∫–∞—Ä—Ç–æ–≤–æ–π —Ç–æ–ø–æ–ª–æ–≥–∏–µ–π üöÄ

### –°–≤–µ–¥–µ–Ω–∏—è –æ —Å—Ç—É–¥–µ–Ω—Ç–µ
**–î–∞—Ç–∞:** 2025-10-22  
**–°–µ–º–µ—Å—Ç—Ä:** 6  
**–ì—Ä—É–ø–ø–∞:** [–ù–æ–º–µ—Ä –≥—Ä—É–ø–ø—ã]  
**–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞:** –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è  
**–°—Ç—É–¥–µ–Ω—Ç:** [–í–∞—à–µ –∏–º—è]

---

## 1. –¶–µ–ª—å —Ä–∞–±–æ—Ç—ã
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –º–µ—Ç–æ–¥–∞ —Å–æ–ø—Ä—è–∂—ë–Ω–Ω—ã—Ö –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤ (CG) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥–µ–∫–∞—Ä—Ç–æ–≤–æ–π —Ç–æ–ø–æ–ª–æ–≥–∏–∏ –≤ MPI. –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ —Å –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç–æ–π ‚Ññ3 (–±–∞–∑–æ–≤—ã–π CG, –ø–æ–ª–Ω–∞—è –∏ —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏–∏).

## 2. –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å
### 2.1. –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è –∏ –∞–ª–≥–æ—Ä–∏—Ç–º—ã
–ú–µ—Ç–æ–¥ —Å–æ–ø—Ä—è–∂—ë–Ω–Ω—ã—Ö –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤ (CG) —Ä–µ—à–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É –ª–∏–Ω–µ–π–Ω—ã—Ö —É—Ä–∞–≤–Ω–µ–Ω–∏–π \( Ax = b \), –≥–¥–µ \( A \) ‚Äî —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–∞—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞. –ú–µ—Ç–æ–¥ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –¥–ª—è —Ä–∞–∑—Ä–µ–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º. –í –¥–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 2D –¥–µ–∫–∞—Ä—Ç–æ–≤–∞ —Ç–æ–ø–æ–ª–æ–≥–∏—è:

- **–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:** –ú–∞—Ç—Ä–∏—Ü–∞ \( A \) –¥–µ–ª–∏—Ç—Å—è –ø–æ —Å—Ç—Ä–æ–∫–∞–º, –≤–µ–∫—Ç–æ—Ä—ã \( x, r, p \) —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏.
- **–¢–æ–ø–æ–ª–æ–≥–∏—è:** –¢–æ—Ä–æ–∏–¥–∞–ª—å–Ω–∞—è 2D-—Å–µ—Ç–∫–∞ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏.
- **–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏:** –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è `Sendrecv_replace` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –æ–±–º–µ–Ω–æ–≤ –∏ `Allreduce` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.
- **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –õ–†3:** –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ç–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –±–∞–∑–æ–≤—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ CG.

### 2.2. –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ MPI
- `MPI.COMM_WORLD`: –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä.
- `comm.Create_cart`: –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ–∫–∞—Ä—Ç–æ–≤–æ–π —Ç–æ–ø–æ–ª–æ–≥–∏–∏.
- `comm_cart.Shift`: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Å–µ–¥–µ–π –≤ —Ç–æ–ø–æ–ª–æ–≥–∏–∏.
- `Sendrecv_replace`: –ö–æ–ª—å—Ü–µ–≤–æ–π –æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏.
- `allreduce`: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (—Å–∫–∞–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è, —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ).
- `MPI.SUM`: –û–ø–µ—Ä–∞—Ü–∏—è —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è `allreduce`.

## 3. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
### 3.1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã
- **–ß–∞—Å—Ç—å 1: –î–µ–∫–∞—Ä—Ç–æ–≤–∞ —Ç–æ–ø–æ–ª–æ–≥–∏—è**
  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MPI, –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ—Å—Ç–∏ —á–∏—Å–ª–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (\( size = root^2 \)).
  - –°–æ–∑–¥–∞–Ω–∏–µ 2D —Ç–æ—Ä–æ–∏–¥–∞–ª—å–Ω–æ–π —Ç–æ–ø–æ–ª–æ–≥–∏–∏ —Å –ø–æ–º–æ—â—å—é `comm.Create_cart`.
  - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Å–µ–¥–µ–π —á–µ—Ä–µ–∑ `Shift` (–≤–µ—Ä—Ç–∏–∫–∞–ª—å –∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å).
  - –ö–æ–ª—å—Ü–µ–≤–æ–π –æ–±–º–µ–Ω —Ä–∞–Ω–≥–∞–º–∏ –∏ —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Å—Ç—Ä–æ–∫–µ —á–µ—Ä–µ–∑ `row_comm.allreduce`.
- **–ß–∞—Å—Ç—å 2: –ú–µ—Ç–æ–¥ CG**
  - –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –º–∞—Ç—Ä–∏—Ü—ã \( A \) –ø–æ —Å—Ç—Ä–æ–∫–∞–º (\( n_{\text{local}} = n / root \)).
  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤ \( b \) (–µ–¥–∏–Ω–∏—á–Ω—ã–π), \( x \) (–Ω—É–ª–µ–≤–æ–π), \( r, p \).
  - –¶–∏–∫–ª CG: –ª–æ–∫–∞–ª—å–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `Allreduce`, –æ–±–º–µ–Ω —á–µ—Ä–µ–∑ `Sendrecv_replace`.
  - –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: \( ||r|| < 1e-6 \), \( |pAp| < 1e-10 \).
- **–ß–∞—Å—Ç—å 3: –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**
  - –ó–∞–º–µ—Ä—ã –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ —É—Å–∫–æ—Ä–µ–Ω–∏—è –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

### 3.2. –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- **–ß–∞—Å—Ç—å 1:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∑–∞–≤—ã—à–µ–Ω–Ω—ã–µ —Å—É–º–º—ã –≤ –∫–æ–ª—å—Ü–µ–≤–æ–º –æ–±–º–µ–Ω–µ –ø—É—Ç—ë–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ–±–º–µ–Ω–∞ –∏ —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ `row_comm.allreduce`.
- **–ß–∞—Å—Ç—å 2:** –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –æ—à–∏–±–∫–∏ `ValueError` (–Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–µ–π) –∏ `RuntimeWarning` (–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å) —á–µ—Ä–µ–∑ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫—É —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–µ–π –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ \( |pAp| < 1e-10 \).
- **–ß–∞—Å—Ç—å 3:** –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –õ–†3, –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å –ø–æ–º–æ—â—å—é matplotlib.

### 3.3. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É
```bash
# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
source venv/bin/activate

# –ß–∞—Å—Ç—å 1: –î–µ–∫–∞—Ä—Ç–æ–≤–∞ —Ç–æ–ø–æ–ª–æ–≥–∏—è
mpirun --oversubscribe -np 4 python cartesian_topology.py > output_4.txt
mpirun --oversubscribe -np 9 python cartesian_topology.py > output_9.txt
mpirun --oversubscribe -np 16 python cartesian_topology.py > output_16.txt

# –ß–∞—Å—Ç—å 2: –ú–µ—Ç–æ–¥ CG
mpirun --oversubscribe -np 4 python conjugate_gradient_cartesian.py
mpirun --oversubscribe -np 9 python conjugate_gradient_cartesian.py
mpirun --oversubscribe -np 16 python conjugate_gradient_cartesian.py

# –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
pip install matplotlib
python performance_plot.py

4. –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å
4.1. –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

–†–∞–∑–º–µ—Ä –º–∞—Ç—Ä–∏—Ü—ã: ( n = 1000 ).
–ú–∞—Ç—Ä–∏—Ü–∞ ( A ): ( A_{\text{full}} = \text{ones}(n, n) + n \cdot \text{eye}(n) ).
–í–µ–∫—Ç–æ—Ä ( b ): –µ–¥–∏–Ω–∏—á–Ω—ã–π.
–í–µ–∫—Ç–æ—Ä ( x ): –Ω–∞—á–∞–ª—å–Ω–æ –Ω—É–ª–µ–≤–æ–π.
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤: 4, 9, 16.

4.2. –ú–µ—Ç–æ–¥–∏–∫–∞ –∏–∑–º–µ—Ä–µ–Ω–∏–π

–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ: –õ–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–º–ø—å—é—Ç–µ—Ä —Å OpenMPI.
–ó–∞–ø—É—Å–∫–∏: –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –≤—ã–ø–æ–ª–Ω—è–ª—Å—è –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ.
–ó–∞–º–µ—Ä—ã: –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ü–∏–∫–ª–∞ CG –¥–ª—è 4, 9, 16 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤. –£—Å–∫–æ—Ä–µ–Ω–∏–µ (( S = T_1 / T_p )) –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (( E = S / p )) —Å—Ä–∞–≤–Ω–∏–≤–∞–ª–∏—Å—å —Å –õ–†3 (( T_1 = 0.0290 ) —Å).

4.3. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑–º–µ—Ä–µ–Ω–∏–π
–¢–∞–±–ª–∏—Ü–∞ 1. –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (—Å–µ–∫—É–Ω–¥—ã)



–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
–õ–†6 (–¢–æ–ø–æ–ª–æ–≥–∏—è)
–õ–†3 (–ü–æ–ª–Ω–∞—è)
–õ–†3 (–£–ø—Ä–æ—â—ë–Ω–Ω–∞—è)



4
0.1732
0.0297
0.0092


9
0.1775
0.0412
0.0152


16
0.4801
0.1225
0.0520


–¢–∞–±–ª–∏—Ü–∞ 2. –£—Å–∫–æ—Ä–µ–Ω–∏–µ (Speedup)



–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
–õ–†6 (–¢–æ–ø–æ–ª–æ–≥–∏—è)
–õ–†3 (–ü–æ–ª–Ω–∞—è)
–õ–†3 (–£–ø—Ä–æ—â—ë–Ω–Ω–∞—è)



4
0.1674
0.9764
1.4021


9
0.1634
0.7039
0.8487


16
0.0604
0.2367
0.2481


–¢–∞–±–ª–∏—Ü–∞ 3. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (Efficiency)



–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
–õ–†6 (–¢–æ–ø–æ–ª–æ–≥–∏—è)
–õ–†3 (–ü–æ–ª–Ω–∞—è)
–õ–†3 (–£–ø—Ä–æ—â—ë–Ω–Ω–∞—è)



4
0.0419
0.2441
0.3505


9
0.0182
0.0782
0.0943


16
0.0038
0.0148
0.0155


5. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
5.1. –ì—Ä–∞—Ñ–∏–∫ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

5.2. –ì—Ä–∞—Ñ–∏–∫ —É—Å–∫–æ—Ä–µ–Ω–∏—è

5.3. –ì—Ä–∞—Ñ–∏–∫ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

6. –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
6.1. –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–£—Å–∫–æ—Ä–µ–Ω–∏–µ: –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –õ–†3 –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–∏–ª—É—á—à–µ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ (1.4021 –¥–ª—è 4 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤), —Ç–æ–≥–¥–∞ –∫–∞–∫ –õ–†6 –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ (0.0604 –¥–ª—è 16 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤) –∏–∑-–∑–∞ –≤—ã—Å–æ–∫–∏—Ö –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∑–∞—Ç—Ä–∞—Ç.
–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –õ–†3 –∏–º–µ–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å 0.3505 (4 –ø—Ä–æ—Ü–µ—Å—Å–∞), –õ–†6 ‚Äî –≤—Å–µ–≥–æ 0.0038 (16 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤).
–£–∑–∫–∏–µ –º–µ—Å—Ç–∞: –ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ Sendrecv_replace –∏ Allreduce –¥–ª—è ( p_{\text{full}} ).

6.2. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–º–∏ –æ—Ü–µ–Ω–∫–∞–º–∏

–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ Sendrecv_replace (( O(n_{\text{local}} \cdot dims[1]) )) —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ Allreduce (( O(n \cdot \log(size)) )) –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –æ–±–º–µ–Ω–æ–≤.
–û–¥–Ω–∞–∫–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, —á—Ç–æ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã –≤ –õ–†6 –ø—Ä–µ–≤—ã—à–∞—é—Ç –≤—ã–≥–æ–¥—É –æ—Ç —Ç–æ–ø–æ–ª–æ–≥–∏–∏.

6.3. –í—ã—è–≤–ª–µ–Ω–∏–µ —É–∑–∫–∏—Ö –º–µ—Å—Ç

–í—ã—Å–æ–∫–æ–µ —á–∏—Å–ª–æ –∏—Ç–µ—Ä–∞—Ü–∏–π (984 –¥–ª—è 4 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤) –∏–∑-–∑–∞ –ø–ª–æ—Ö–æ–π –æ–±—É—Å–ª–æ–≤–ª–µ–Ω–Ω–æ—Å—Ç–∏ –º–∞—Ç—Ä–∏—Ü—ã.
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ ( size = root^2 ) —Å–Ω–∏–∂–∞–µ—Ç –≥–∏–±–∫–æ—Å—Ç—å.
–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ Sendrecv_replace –∏ Allreduce.

7. –û—Ç–≤–µ—Ç—ã –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
–í–æ–ø—Ä–æ—Å 1: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ—Ç–æ–¥ —Å–æ–ø—Ä—è–∂—ë–Ω–Ω—ã—Ö –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤?
–ú–µ—Ç–æ–¥ CG –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é ( f(x) = \frac{1}{2}x^T A x - b^T x ) –ø—É—Ç—ë–º –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –æ—Ä—Ç–æ–≥–æ–Ω–∞–ª—å–Ω—ã—Ö –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏ —Å–æ–ø—Ä—è–∂—ë–Ω–Ω—ã—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π.
–í–æ–ø—Ä–æ—Å 2: –ó–∞—á–µ–º –Ω—É–∂–Ω–∞ –¥–µ–∫–∞—Ä—Ç–æ–≤–∞ —Ç–æ–ø–æ–ª–æ–≥–∏—è?
–î–µ–∫–∞—Ä—Ç–æ–≤–∞ —Ç–æ–ø–æ–ª–æ–≥–∏—è —É–ø—Ä–æ—â–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å–µ–¥—è–º–∏ –∏ –æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏ –≤ –º–Ω–æ–≥–æ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö, –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è –∑–∞–¥–∞—á —Å —Ä–µ–≥—É–ª—è—Ä–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.
–í–æ–ø—Ä–æ—Å 3: –ü–æ—á–µ–º—É —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–∞–¥–∞–µ—Ç —Å —Ä–æ—Å—Ç–æ–º —á–∏—Å–ª–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤?
–†–æ—Å—Ç –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∑–∞—Ç—Ä–∞—Ç (–æ—Å–æ–±–µ–Ω–Ω–æ –Ω–∞ Allreduce) –∏ –¥–∏—Å–±–∞–ª–∞–Ω—Å –Ω–∞–≥—Ä—É–∑–∫–∏ —Å–Ω–∏–∂–∞—é—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ —á–∏—Å–ª–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.
–í–æ–ø—Ä–æ—Å 4: –ö–∞–∫ –≤–ª–∏—è–µ—Ç –æ–±—É—Å–ª–æ–≤–ª–µ–Ω–Ω–æ—Å—Ç—å –º–∞—Ç—Ä–∏—Ü—ã –Ω–∞ —Å—Ö–æ–¥–∏–º–æ—Å—Ç—å?
–ü–ª–æ—Ö–∞—è –æ–±—É—Å–ª–æ–≤–ª–µ–Ω–Ω–æ—Å—Ç—å (–±–ª–∏–∑–æ—Å—Ç—å ( A ) –∫ –≤—ã—Ä–æ–∂–¥–µ–Ω–Ω–æ–π) —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —á–∏—Å–ª–æ –∏—Ç–µ—Ä–∞—Ü–∏–π, –∑–∞–º–µ–¥–ª—è—è —Å—Ö–æ–¥–∏–º–æ—Å—Ç—å.
–í–æ–ø—Ä–æ—Å 5: –ö–∞–∫–∏–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–∞—ë—Ç Sendrecv_replace?
Sendrecv_replace –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –æ–±—ä—ë–º –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∑–∞–º–µ–Ω—è—è –±—É—Ñ–µ—Ä –Ω–∞ –º–µ—Å—Ç–µ, —á—Ç–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –æ–±–º–µ–Ω–æ–≤.
–í–æ–ø—Ä–æ—Å 6: –ö–∞–∫ —Å—Ä–∞–≤–Ω–∏—Ç—å –õ–†3 –∏ –õ–†6?
–õ–†3 (—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è) –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ –º–∞–ª–æ–º —á–∏—Å–ª–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –õ–†6 –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç –∏–∑-–∑–∞ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π.
–í–æ–ø—Ä–æ—Å 7: –ö–∞–∫ —É–ª—É—á—à–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å?
–£–≤–µ–ª–∏—á–∏—Ç—å –¥–∏–∞–≥–æ–Ω–∞–ª—å–Ω–æ–µ –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã –∏ –ø–æ—Ä–æ–≥ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏ (( tol = 1e-4 )).
–í–æ–ø—Ä–æ—Å 8: –ö–∞–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ç–æ–ø–æ–ª–æ–≥–∏–∏?
–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ ( size = root^2 ) –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –≤—ã–±–æ—Ä —á–∏—Å–ª–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.
–í–æ–ø—Ä–æ—Å 9: –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏?
–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å numpy.linalg.lstsq.
–í–æ–ø—Ä–æ—Å 10: –ö–∞–∫–∏–µ –≤—ã–≤–æ–¥—ã –ø–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏?
–õ–†6 –º–µ–Ω–µ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞, —á–µ–º –õ–†3, –∏–∑-–∑–∞ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∑–∞—Ç—Ä–∞—Ç.
8. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
8.1. –í—ã–≤–æ–¥—ã

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –¥–µ–∫–∞—Ä—Ç–æ–≤–∞ —Ç–æ–ø–æ–ª–æ–≥–∏—è –∏ –º–µ—Ç–æ–¥ CG —Å —Ç–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º –æ–±–º–µ–Ω–æ–º.
–õ–†6 –º–µ–Ω–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞, —á–µ–º –õ–†3, –∏–∑-–∑–∞ –≤—ã—Å–æ–∫–∏—Ö –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∑–∞—Ç—Ä–∞—Ç.
–ü—Ä–æ–≤–µ–¥–µ–Ω–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –õ–†3, –ø–æ—Å—Ç—Ä–æ–µ–Ω—ã –≥—Ä–∞—Ñ–∏–∫–∏.

8.2. –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

–ó–∞–≤—ã—à–µ–Ω–Ω—ã–µ —Å—É–º–º—ã –≤ –ß–∞—Å—Ç—å 1: –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã —á–µ—Ä–µ–∑ row_comm.allreduce.
–û—à–∏–±–∫–∏ –≤ –ß–∞—Å—Ç—å 2: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã ValueError (—Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏) –∏ RuntimeWarning (–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å).

8.3. –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã —É–ª—É—á—à–µ–Ω–∏—è

–£–≤–µ–ª–∏—á–∏—Ç—å –¥–∏–∞–≥–æ–Ω–∞–ª—å–Ω–æ–µ –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã (( A_{\text{full}} += 100 \cdot n \cdot \text{eye}(n) )).
–£–≤–µ–ª–∏—á–∏—Ç—å –ø–æ—Ä–æ–≥ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏ (( tol = 1e-4 )).
–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏, –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—è Allreduce.

9. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è
9.1. –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
cartesian_topology.py
from mpi4py import MPI
import numpy as np
import math

comm = MPI.COMM_WORLD
rank = comm.Get_rank()
size = comm.Get_size()

root = int(math.sqrt(size))
if root * root != size:
    if rank == 0:
        print("–û—à–∏–±–∫–∞: –ß–∏—Å–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫–≤–∞–¥—Ä–∞—Ç–æ–º –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–æ–≥–æ —á–∏—Å–ª–∞!")
    MPI.Finalize()
    exit()

dims = (root, root)
periods = (True, True)
comm_cart = comm.Create_cart(dims=dims, periods=periods, reorder=True)

new_rank = comm_cart.Get_rank()
coords = comm_cart.Get_coords(new_rank)

print(f"–ü—Ä–æ—Ü–µ—Å—Å {rank} -> –ù–æ–≤—ã–π —Ä–∞–Ω–≥ {new_rank}, –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã {coords}")

neighbour_up, neighbour_down = comm_cart.Shift(direction=0, disp=1)
neighbour_left, neighbour_right = comm_cart.Shift(direction=1, disp=1)

print(f"–ü—Ä–æ—Ü–µ—Å—Å {new_rank} (coords {coords}): –í–µ—Ä—Ö–Ω–∏–π —Å–æ—Å–µ–¥ = {neighbour_up}, "
      f"–ù–∏–∂–Ω–∏–π —Å–æ—Å–µ–¥ = {neighbour_down}, –õ–µ–≤—ã–π —Å–æ—Å–µ–¥ = {neighbour_left}, "
      f"–ü—Ä–∞–≤—ã–π —Å–æ—Å–µ–¥ = {neighbour_right}")

a = np.array([new_rank], dtype=np.float64)
total_sum = a.copy()

row_comm = comm_cart.Sub((False, True))

for _ in range(dims[1] - 1):
    send_buf = a.copy()
    comm_cart.Sendrecv_replace(send_buf, dest=neighbour_right, source=neighbour_left)
    total_sum += send_buf

row_sum = np.array([new_rank], dtype=np.float64)
row_sum = row_comm.allreduce(row_sum, op=MPI.SUM)

print(f"–ü—Ä–æ—Ü–µ—Å—Å {new_rank} (coords {coords}): –°—É–º–º–∞ –ø–æ—Å–ª–µ –∫–æ–ª—å—Ü–∞ = {row_sum[0]}")

conjugate_gradient_cartesian.py
from mpi4py import MPI
import numpy as np
import math

comm = MPI.COMM_WORLD
rank = comm.Get_rank()
size = comm.Get_size()

root = int(math.sqrt(size))
if root * root != size:
    if rank == 0:
        print("–û—à–∏–±–∫–∞: –ß–∏—Å–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫–≤–∞–¥—Ä–∞—Ç–æ–º –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–æ–≥–æ —á–∏—Å–ª–∞!")
    MPI.Finalize()
    exit()

dims = (root, root)
periods = (True, True)
comm_cart = comm.Create_cart(dims=dims, periods=periods, reorder=True)
coords = comm_cart.Get_coords(comm_cart.Get_rank())

n = 1000
n_local = n // root

A_full = np.ones((n, n)) + n * np.eye(n)
start_row = coords[0] * n_local
A_part = A_full[start_row:start_row + n_local, :]

b_local = np.ones(n_local)
x_local = np.zeros(n_local)

r_local = b_local - np.dot(A_part, np.zeros(n))
p_local = r_local.copy()
p_full = np.zeros(n)
start_idx = coords[0] * n_local
p_full[start_idx:start_idx + n_local] = p_local
comm_cart.Allreduce(MPI.IN_PLACE, p_full, op=MPI.SUM)

tol = 1e-6
max_iter = 10000
start_time = MPI.Wtime()
rsold = np.dot(r_local, r_local)
rsold_global = comm_cart.allreduce(rsold, op=MPI.SUM)

for i in range(max_iter):
    Ap_local = np.dot(A_part, p_full)
    pAp = np.dot(p_local, Ap_local)
    pAp_global = comm_cart.allreduce(pAp, op=MPI.SUM)
    
    if abs(pAp_global) < 1e-10:
        break
    
    alpha = rsold_global / pAp_global
    x_local += alpha * p_local
    r_local -= alpha * Ap_local
    rsnew = np.dot(r_local, r_local)
    rsnew_global = comm_cart.allreduce(rsnew, op=MPI.SUM)
    
    if rsnew_global < tol:
        break
    
    beta = rsnew_global / rsold_global
    p_local = r_local + beta * p_local
    p_full[start_idx:start_idx + n_local] = p_local
    comm_cart.Allreduce(MPI.IN_PLACE, p_full, op=MPI.SUM)
    rsold_global = rsnew_global

if rank == 0:
    print(f"Iterations: {i}, Time: {MPI.Wtime() - start_time:.4f} seconds")

performance_plot.py
import matplotlib.pyplot as plt

processes = [4, 9, 16]
times_cart = [0.1732, 0.1775, 0.4801]
times_base_full = [0.0297, 0.0412, 0.1225]
times_base_simple = [0.0092, 0.0152, 0.0520]

speedup_base_full = [0.0290 / t for t in times_base_full]
speedup_base_simple = [0.0290 / t for t in times_base_simple]
speedup_cart = [0.0290 / t for t in times_cart]

efficiency_base_full = [s / p for s, p in zip(speedup_base_full, processes)]
efficiency_base_simple = [s / p for s, p in zip(speedup_base_simple, processes)]
efficiency_cart = [s / p for s, p in zip(speedup_cart, processes)]

plt.figure(figsize=(10, 5))

plt.subplot(1, 2, 1)
plt.plot(processes, speedup_base_full, label="–ë–∞–∑–æ–≤—ã–π CG –ø–æ–ª–Ω—ã–π (–õ–†3)", marker='o')
plt.plot(processes, speedup_base_simple, label="–ë–∞–∑–æ–≤—ã–π CG —É–ø—Ä–æ—â—ë–Ω–Ω—ã–π (–õ–†3)", marker='o')
plt.plot(processes, speedup_cart, label="–¢–æ–ø–æ–ª–æ–≥–∏—è (–õ–†6)", marker='o')
plt.xlabel("–ß–∏—Å–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤")
plt.ylabel("–£—Å–∫–æ—Ä–µ–Ω–∏–µ")
plt.legend()

plt.subplot(1, 2, 2)
plt.plot(processes, efficiency_base_full, label="–ë–∞–∑–æ–≤—ã–π CG –ø–æ–ª–Ω—ã–π (–õ–†3)", marker='o')
plt.plot(processes, efficiency_base_simple, label="–ë–∞–∑–æ–≤—ã–π CG —É–ø—Ä–æ—â—ë–Ω–Ω—ã–π (–õ–†3)", marker='o')
plt.plot(processes, efficiency_cart, label="–¢–æ–ø–æ–ª–æ–≥–∏—è (–õ–†6)", marker='o')
plt.xlabel("–ß–∏—Å–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤")
plt.ylabel("–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å")
plt.legend()

plt.tight_layout()
plt.savefig("images/performance_comparison.png")

9.2. –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –≤–µ—Ä—Å–∏–∏

Python 3.8+
mpi4py 3.1.+
NumPy 1.21.+
OpenMPI 4.1.+
Matplotlib 3.4.+

9.3. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞

Saad, Y. "Iterative Methods for Sparse Linear Systems" - –û—Å–Ω–æ–≤—ã –º–µ—Ç–æ–¥–∞ —Å–æ–ø—Ä—è–∂—ë–Ω–Ω—ã—Ö –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤.
Gropp, W. et al. "Using MPI: Portable Parallel Programming with the Message-Passing Interface" - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ MPI.
Pacheco, P. "Parallel Programming with MPI" - –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –≤–≤–µ–¥–µ–Ω–∏–µ –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å MPI.


–û—Ç—á–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –≤ —Ä–∞–º–∫–∞—Ö –∫—É—Ä—Å–∞ "–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è"```
